<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/ds/http.js | px-mobile.js API API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="git+https://github.com/jonniespratley/px-mobilejs.git">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/base.js~BaseClass.html">BaseClass</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-pxMobile">pxMobile</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/x-module.js~xModule.html">xModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">core</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/core.js~Core.html">Core</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/plugins.js~Plugins.html">Plugins</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/pubsub.js~PubSub.html">PubSub</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/router-history.js~RouterHistory.html">RouterHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/service-locator.js~ServiceLocator.html">ServiceLocator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/simple-router.js~SimpleRouter.html">SimpleRouter</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ds</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ds/collection.js~Collection.html">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ds/db.js~DB.html">DB</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ds/http.js~HTTP.html">HTTP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ds/model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">elements</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/elements/pm-page.js~pmPage.html">pmPage</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ui</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/app.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/component.js~Component.html">Component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/element.js~Element.html">Element</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/elements.js~Elements.html">Elements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/page.js~Page.html">Page</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/pages.js~Pages.html">Pages</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/view.js~View.html">View</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ui/views.js~Views.html">Views</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/dom.js~DOM.html">DOM</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/interface.js~Interface.html">Interface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/log.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dom">dom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addMixin">addMixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-debounce">debounce</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extend">extend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extendClass">extendClass</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extendDeep">extendDeep</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mix">mix</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mixin">mixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-resolveURL">resolveURL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-type">type</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-uuid">uuid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$">$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Interfaces">Interfaces</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-aggregation">aggregation</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/ds/http.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*globals Request, Promise*/
&apos;use strict&apos;;
import BaseClass from &apos;../base&apos;;
//import fetch from &apos;fetch&apos;;

/**
 * HTTP class provides an abstraction layer for HTTP calls.
 * @example
 * var $http = new px.mobile.HTTP(&apos;http1&apos;, {
 *	baseUrl: window.location.origin
 * });
 */
export default class HTTP extends BaseClass {

	/**
	 * Create a new instance of a HTTP service.
	 * @constructor
	 * @param {String} name - The name of the service
	 * @param {Object} options - The default options to pass
	 * @return {HTTP} An instance of the HTTP class
	 */
	constructor(name = &apos;http&apos;, options = {
		baseUrl: &apos;/default&apos;
	}) {
		super(name, options);

		if (!options.baseUrl) {
			//throw new Error(&apos;HTTP: Must provide a baseUrl&apos;);
				this.log.logApi(&apos;[HTTP] - Using default baseUrl - /default&apos;);
		}

		return this;
	}

	/**
	 *	I handle checking the response status code of a HTTP request.
	 * @param {Response} response A Response object
	 * @return {Response} The original response
	 */
	checkStatus(response) {

		if (response.status &gt;= 200 &amp;&amp; response.status &lt; 300) {
			return response;
		} else {
			var error = new Error(response.statusText);
			error.response = response;
			return response;
		}
	}

	/**
	 * I handle parsing the JSON of a response.
	 * @param {Response} response A Response object
	 * @return {Response} The original response with a data property that is the parsed JSON
	 */
	parseJSON(response) {
		if (!response) {
			throw new Error(&apos;Must pass a response object to parseJSON!&apos;);
		}
		return response.json().then(function(json) {
			response.data = json;
			return response;
		});
	}

	/**
	 *	I make a HTTP request for JSON.
	 * @example
	 * $http.getJSON(&apos;/default/_all_docs&apos;, {limit: 5}).then(function(resp){
	 *		//handle json
	 * }).catch(function(err){
	 *		//handle error
	 * });
	 * @param {String} url - The url
	 * @param {Object} options - Request options object
	 * @return {Promise} A promise that resolves a response
	 */
	getJSON(url = &apos;&apos;, options = {}) {
		return fetch(url, options || {
			method: &apos;GET&apos;
		})
			.then(this.checkStatus)
			.then(this.parseJSON);
	}

	/**
	 * The response object has these properties:
	 * @example
	 * $http.request(&apos;/default&apos;, {
	 *		method: &apos;POST&apos;,
	 *		data: data
	 * }).then(function(resp){
	 *		//handle response
	 * }).catch(function(err){
	 *		//handle error
	 * });
	 * @param {String} url - The url
	 * @param {Object} options - Options to pass
	 * @return {Promise} A promise that resolves a response
	 */
	request(url, options) {
		var _this = this;
		var config = this.utils.extend({
			data: null,
			params: null,
			body: null,
			method: &apos;GET&apos;,
			headers: {
				&apos;Content-Type&apos;: &apos;application/json&apos;
			}
		}, options);

		if (options.data) {
			config.body = JSON.stringify(options.data);
			delete config.data;
		}


		url = this.utils.resolveURL(this.baseUrl, url);
		//url = this.utils.resolveURL(url);

		if (options.params) {
			url = this.utils.resolveURL(url, options.params);
			delete options.params;
		}

		//this.log.logApi(`request =&gt; ${url}`, config);
		this.log.logHttp(config.method, url);

		let benchmark = this.log.logTime(&apos;request&apos;);
		return new Promise((resolve, reject) =&gt; {
			return fetch(url, config)
				.then((resp) =&gt; {
				this.log.logHttp(resp.status + &apos; &apos; + benchmark.end(), resp, true);
				//return this.parseJSON(resp).then(resolve, reject);
				resp.data = {};
				resolve(resp);
			}, reject);
		});
	}

	/**
	 * I make a HTTP GET request.
	 * @example
	 * $http.get(&apos;/default/_all_docs&apos;, {limit: 5}).then(function(resp){
	 *		//handle resp:Response
	 * }).catch(function(err){
	 *		//handle error
	 * });
	 * @param {String} url The url
	 * @param {Object} options Options to pass
	 * @return {Promise} A promise that resolves a response
	 */
	get(url, options = {}) {
		this.log.logApi(&apos;get&apos;, options);
		return this.request(url, options).then(this.parseJSON);
	}

	/**
	 * I make a HTTP PUT request.
	 * @example
	$http.put(&apos;/default/id&apos;, {name: &apos;value&apos;}).then(function(resp){
		//handle resp:Response
	}).catch(function(err){
		//handle error
	});
	 * @param {String} url The url
	 * @param {Object} options Options to pass
	 * @return {Promise} A promise that resolves a response
	 */
	put(url, data = null, options = {}) {
		this.log.logApi(&apos;put&apos;, data);
		return this.request(url, this.utils.extend({
			method: &apos;PUT&apos;,
			data: data
		}, options));
	}

	/**
	 * I make a HTTP POST request.
	 * @example
 $http.post(&apos;/default&apos;, {name: &apos;value&apos;}).then(function(resp){
	 //handle resp:Response
 }).catch(function(err){
	 //handle error
 });

	 * @param {String} url The url
	 * @param {Object} options Options to pass
	 * @return {Promise} A promise that resolves a response
	 */
	post(url, data = null, options = {}) {
		return this.request(url, this.utils.extend({
			method: &apos;POST&apos;,
			data: data
		}, options));
	}

	/**
	 * I make a HTTP DELETE request.
	 * @example
 $http.delete(&apos;/default/id&apos;).then(function(resp){
	 //handle resp:Response
 }).catch(function(err){
	 //handle error
 });

	 * @param {String} url The url
	 * @param {Object} options Options to pass
	 * @return {Promise} A promise that resolves a response
	 */
	delete(url = &apos;&apos;, options = {}) {
		return this.request(url, this.utils.extend({
			method: &apos;DELETE&apos;
		}, options));
	}

	/**
	 * I make a HTTP HEAD request.
	 * @example
	$http.head(&apos;/default/id&apos;).then(function(resp){
		//handle resp:Response
	}).catch(function(err){
		//handle error
	});

	 * @param {String} url The url
	 * @param {Object} options Options to pass
	 * @return {Promise} A promise that resolves a response
	 */
	head(url = &apos;&apos;, options = {}) {
		return this.request(url, this.utils.extend({
			method: &apos;HEAD&apos;
		}, options));
	}

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
